<!DOCTYPE html>
<html lang="es">
<head>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#002D5A">
    <meta charset="UTF-8">
    <title>Login - CEN</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-blue-900 flex items-center justify-center min-h-screen">
    <div class="bg-white p-8 rounded shadow-lg w-80">
        <h2 class="text-xl font-bold mb-4 text-center">Entrar al Sistema</h2>
        <input type="email" id="email" placeholder="Correo" class="w-full mb-2 p-2 border">
        <input type="password" id="pass" placeholder="Contraseña" class="w-full mb-4 p-2 border">
        <button onclick="entrar()" class="w-full bg-blue-700 text-white p-2 rounded">LOGIN</button>
        <a href="registro.html" class="block text-center mt-4 text-sm text-gray-500">¿Eres nuevo? Regístrate</a>
    </div>

    <script>
async function entrar() {
    const res = await fetch('http://localhost:3000/login', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({
            email: document.getElementById('email').value,
            password: document.getElementById('pass').value
        })
    });

if (res.ok) {
    const data = await res.json();
    localStorage.setItem('usuario', data.nombre);
    localStorage.setItem('rol', data.rol);
    localStorage.setItem('id_usuario', data.id_usuario);
    
    // Si es representante, guardamos la cédula de su hijo
    if (data.cedula_hijo) {
        localStorage.setItem('cedula_hijo', data.cedula_hijo);
    }
    window.location.href = 'dashboard.html';
    } else {
        alert("Correo o clave incorrecta");
    }
}
  
if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('https://cdnjs.cloudflare.com/ajax/libs/serviceworker/0.1.0/serviceworker.min.js')
    .then(() => console.log("Modo Móvil PWA Activado"));
  }
    </script>
</body>
</html>